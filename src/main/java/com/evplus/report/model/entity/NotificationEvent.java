package com.evplus.report.model.entity;

import jakarta.persistence.*;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.time.LocalDateTime;

/**
 * JPA Entity for notification events.
 * Maps to the existing 'notification_events' table in the database.
 * Write-only entity used to record report completion events.
 */
@Entity
@Table(name = "notification_events")
@Data
@NoArgsConstructor
@AllArgsConstructor
public class NotificationEvent {

    /**
     * Auto-generated primary key.
     */
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "id", nullable = false, columnDefinition = "INT")
    private Integer id;

    /**
     * District ID for the notification.
     */
    @Column(name = "district_id", nullable = false)
    private Integer districtId;

    /**
     * Event type (e.g., 'REPORT_READY_FOR_DOWNLOAD').
     */
    @Column(name = "event", length = 40)
    private String event;

    /**
     * Event timestamp.
     */
    @Column(name = "date")
    private LocalDateTime date;

    /**
     * User ID who should receive the notification.
     */
    @Column(name = "user_id", nullable = false)
    private Integer userId;

    /**
     * Integer object reference (optional).
     */
    @Column(name = "object_int")
    private Integer objectInt;

    /**
     * String object reference (e.g., report job ID).
     */
    @Column(name = "object_str")
    private String objectStr;

    /**
     * Record creation timestamp (auto-generated by database).
     */
    @Column(name = "created", nullable = false, updatable = false)
    private LocalDateTime created;

    /**
     * Flag indicating if attachments are needed.
     */
    @Column(name = "needAttachments", nullable = false)
    private Boolean needAttachments = false;

    /**
     * Target ID for the notification (optional).
     */
    @Column(name = "target_id")
    private Integer targetId;

    /**
     * Notification message body (JSON format for report notifications).
     */
    @Column(name = "message", columnDefinition = "TEXT")
    private String message;

    /**
     * JPA lifecycle callback to set timestamp before insert.
     */
    @PrePersist
    protected void onCreate() {
        if (created == null) {
            created = LocalDateTime.now();
        }
        if (date == null) {
            date = LocalDateTime.now();
        }
    }
}
