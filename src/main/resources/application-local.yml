# Local Development Environment Configuration

spring:
  # LocalStack Configuration for Local Development
  cloud:
    aws:
      region:
        static: us-east-1  # LocalStack uses us-east-1 by default
      # Static credentials for LocalStack
      # These override the DefaultCredentialsProvider chain
      credentials:
        access-key: test
        secret-key: test
      # LocalStack endpoint overrides
      s3:
        enabled: true
        endpoint: http://localhost:4566
        path-style-access-enabled: true  # Required for LocalStack S3 and presigned URLs
      sqs:
        enabled: true
        endpoint: http://localhost:4566
      ses:
        enabled: true
        endpoint: http://localhost:4566
      secretsmanager:
        enabled: false  # Disable Secrets Manager for local development

  # Local Database Configuration (Plain text credentials - LOCAL ONLY)
  datasource:
    url: jdbc:mysql://localhost:3306/teachpoint?useSSL=false&allowPublicKeyRetrieval=true
    username: tpuser
    password: tppass1
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 2
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000

  # Local Redis Configuration (No SSL)
  data:
    redis:
      host: localhost
      port: 6379
      password:  # No password for local Redis
      timeout: 2000
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 2

  # Security - OAuth2 Configuration
  security:
    oauth2:
      resourceserver:
        jwt:
          # Use jwk-set-uri directly since OIDC discovery is at non-standard location
          jwk-set-uri: ${OIDC_JWK_SET_URI:http://localhost:8080/.well-known/openid-configuration/jwks}
          # Expected issuer claim in JWT tokens
          issuer-uri: ${OIDC_ISSUER_URI:http://localhost:8080/vector-eval/v2}

# Local AWS Service Configuration
aws:
  s3:
    bucket-name: ev-plus-reports-local
  sqs:
    queue-name: ev-plus-reporting-local-queue
  email:
    from-address: noreply-local@evplus.com
    enabled: false  # Mock email service for local

# Notification Queue Configuration (LocalStack)
notification:
  queue:
    name: ev-plus-notifications-local-queue

# Server Configuration
server:
  tomcat:
    accesslog:
      enabled: true
      # Human-readable pattern for local development
      pattern: '%t %h "%r" %s (%D ms) %b bytes'

# Logging - More verbose for local development
logging:
  level:
    com.evplus.report: DEBUG
    org.springframework.web: DEBUG
    org.springframework.security: DEBUG
    org.hibernate.SQL: DEBUG
    io.awspring.cloud: DEBUG
